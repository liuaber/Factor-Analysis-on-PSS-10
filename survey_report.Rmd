---
title: "Covid_19 Survey Data Analysis"
author: "Bowen Liu"
date: "2/6/2021"
output: html_document
---
### This section provides detailed explanation and design of the survey raffle drawing approved by Institutional Revision Board, University of Nevada, Las Vegas. 
```{r Survey Drawing, include=FALSE}
#survey drawing
#mail_list = read.csv("survey_drawing.csv")
#str(mail_list)
#mail_list = mail_list$email
#length(mail_list)
#null_res = which(mail_list == "")
#length(null_res) #125 null responses
#mail_list_clean = mail_list[-null_res]
#length(mail_list_clean)
#length(mail_list_clean)+length(null_res)==length(mail_list) #TRUE
#which(mail_list_clean=="") #integer(0)
#sample_size = length(mail_list_clean)
#set.seed(993)
#lucky_dogs = sample(1:sample_size,10)
#mail_list_clean[lucky_dogs]
# Notice since the seed was not chosen, this result might be
# replicated in any forms under any different R environment
#[1] "magalv1@unlv.nevada.edu"  "retumr1@unlv.nevada.edu"  "Kingt15@unlv.Nevada.edu" 
#[4] "foulk@unlv.nevada.edu"    "wooe1@unlv.nevada.edu"    "zamane1@unlv.nevada.edu" 
#[7] "parkel2@unlv.nevada.edu"  "Ortize13@unlv.nevada.edu" "kjer@unlv.nevada.edu"    
#[10] "mahmoz1@unlv.nevada.edu" 
```

### This section provides detailed steps for data cleaning and filtering. Notice the raw data was collected and saved under the corresponding Qualtrics account asscoaited with University of Nevada, Las Vegas. 

## Disclaimer Form Here
```{r Data Cleaning: Step 1, include=TRUE}
setwd("~/Desktop/covid19_survey")
covid = read.csv("covid19_data.csv")
sum(is.na(covid$Q1)) 
# There are 2 null responses for Q1, which indicates these 2 "participants" did 
# not click on anaything to the informed consent form at the beginning. Hence, it's reasonabale to exclude them as part of this study. 
covid = covid[-c(which(is.na(covid$Q1)==TRUE)),] 
dim(covid) #Check if the null responses have been removed. 
sum(covid$Q1 == 6) 
#6 indicates that these "participants"" answered no for the informed consent form, 
#Thus, we have 5 people did not agree with the information consent form. They
#should be excluded from the participants of this study. 
covid = covid[-c(which(covid$Q1 == 6)),] 
#dim(covid) #Now this should leave us with 2083 responses in total from the start
#### Demographics continues here
```
### Demographics
```{r Demographics}
 dim(covid) #Check the number of responses again, now it's 2083 after we delete the ones who answer "no" or leave blank for Q1. 

```



### CAS scale data cleaning starts here. (With primary explanatory data analysis)
We decided to remove any of the participants that did not fully answer all 5 CAS scale questions for this section. Then, for the rest of the participants, a specific data frame will be created and their CAS score will be calculated. 

The calculation of CAS score follows the guidelines below 
(Following the version provided by Sherman A. Lee (2020)):
Sherman A. Lee (2020) Coronavirus Anxiety Scale: A brief mental
health screener for COVID-19 related anxiety, Death Studies, 44:7, 393-401, DOI:
10.1080/07481187.2020.1748481
"Elevated CAS scores were found to be associated with coronavirus diagnosis, impairment, alcohol/drug coping, negative religious coping, extreme hopelessness, suicidal ideation, as well as attitudes toward "former" President Trump and Chinese products. The CAS discriminates well between persons with and without dysfunctional anxiety using an optimized cut score of â‰¥ 9 (90% sensitivity and 85% specificity)."

```{r CAS: Coronavirus Anxiety Scale}
covid_cas = covid[-c(which(is.na(covid$CAS_1)==TRUE|is.na(covid$CAS_2)==TRUE|is.na(covid$CAS_3)==TRUE|
is.na(covid$CAS_4)==TRUE|is.na(covid$CAS_5)==TRUE)),]
dim(covid_cas) #167 responses was deleted here. 1911 responses left for CAS scale calculation
##### We shall only include complete responses for a scale. 
##### Adding a column for total score of CAS, notice in the qualtrics the responses were labelled as 1-5.
##### Instead the actual range for each response is 0-4. 
attach(covid_cas)
covid_cas$CAS_total = CAS_1+CAS_2+CAS_3+CAS_4+ CAS_5 -5 #-5 for the reasons we stated above
#detach(covid_cas)

anxiety_class = c(sum(CAS_total<9),sum(CAS_total>=9))
anxiety_class_percent = c(sum(CAS_total<9),sum(CAS_total>=9))/length(CAS_total)

pie(anxiety_class,labels = c("Participants without \n Dysfunctional Anxiety \n (94.19%)","Participants with \n Dysfunctional Anxiety \n (5.81%)"),cex = 1.1,col = c('azure','firebrick'),radius = 1)

hist(covid_cas$CAS_total,breaks = seq(0,20,by=2),main = "The distribution of CAS score \n among student participants in UNLV", xlab = "CAS score",ylab = "No. of Students",col = seq(1,10))
#### Honestly we care about the group such that have >= 9 in a CAS scale. 
cas_sum = c(sum(covid_cas$CAS_total>=9),sum(covid_cas$CAS_total<9))
name = c("CAS score \n >=9","CAS score \n <9")
barplot(cas_sum,names.arg = name,main = "Distribution of CAS scores of \n 1911 participants from UNLV",ylim = c(0,2000),col = c('red','grey'),cex.names = 0.7,ylab = "Number of Participants")

###### Gender analysis (Q1.1 coding: Female: 2; Male: 1)
### First delete the rows such that gender is NA from covid_cas file
sum(is.na(covid_cas$Q1.1==TRUE)) #There're 154 students that didn't respond to this question. 
covid_cas_gender = covid_cas[-c(which(is.na(covid_cas$Q1.1==TRUE))),] #Delete the rows, 1757 responses left. 
### Now organize the data frame to test the difference in CAS score among different gender group
data_gender = data.frame(
  Sex = as.factor(covid_cas_gender$Q1.1),
  CAS_Score = covid_cas_gender$CAS_total
)
table(data_gender$Sex)
library(ggplot2)
ggplot(data_gender)+aes(x = Sex,y = CAS_Score)+ geom_boxplot(fill="grey")
## We shall see a big difference between the distribution of Male, Female and "other", then check the histogram of each subgroup
par(mfrow = c(3,1))
hist(subset(data_gender,Sex==1)$CAS_Score, main = "CAS Score for Male Students")
hist(subset(data_gender,Sex==2)$CAS_Score, main = "CAS Score for Female Students")
hist(subset(data_gender,Sex==3)$CAS_Score, main = "CAS Score for Other Students") ### None of the above follows a normal distribution, hence we attempt to do Shapiro-Wilks test to check the normality
shapiro.test(subset(data_gender,Sex==1)$CAS_Score)
shapiro.test(subset(data_gender,Sex==2)$CAS_Score)
shapiro.test(subset(data_gender,Sex==3)$CAS_Score)
###We shall reject the normality assumptions for all of these, we should go for Kruskal-Wallis test (Wilcox test is for 2 groups comparison)
kruskal.test(CAS_Score~Sex,data = data_gender)

### This suggest we reject the null since the p-value is 1.659e-13. We conclude there're significant difference between gender groups.
sum(subset(data_gender,Sex==1)$CAS_Score>=9)
sum(subset(data_gender,Sex==1)$CAS_Score<9)
sum(subset(data_gender,Sex==2)$CAS_Score>=9)
sum(subset(data_gender,Sex==2)$CAS_Score<9)
sum(subset(data_gender,Sex==3)$CAS_Score>=9)
sum(subset(data_gender,Sex==3)$CAS_Score<9)

### However, if we wanna justify such difference was genuinely made by the difference in sex orientation, we shall perform a permutation test will label exchange and see the location of test statistic within a whole distribution. (This shall be performed later.)
### One suggestion: perm.kruskal.test
#From RVAideMemoire v0.9-8-5
#by Maxime Herv
library(RVAideMemoire)

### Now we want to investigate if there is a difference in CAS score between transgenders and non-trangenders group
###### Transgender analysis (Q2 coding: Non-transgender: 2; Transgender: 1; Other: 3)
sum(is.na(covid_cas$Q2==TRUE)) #There're 153 students that didn't respond to this question. 
covid_cas_trans = covid_cas[-c(which(is.na(covid_cas$Q2==TRUE))),] #Delete the rows, 1758 responses left. 
### Now organize the data frame to test the difference in CAS score among different transgender group
data_trans = data.frame(
  Transgender = as.factor(covid_cas_trans$Q2),
  CAS_Score = covid_cas_trans$CAS_total
)
library(ggplot2)
ggplot(data_trans)+aes(x = Transgender,y = CAS_Score)+ geom_boxplot(fill="grey")
kruskal.test(CAS_Score~Transgender,data = data_trans)#Reject the null 

##### Classification of student status
### Now we want to investigate if there is a difference in CAS score between undergrads, masters and PhD students
###### Classification (Q6 coding:6: Master; 7: PhD; 8: Not seeking for degree; 9: Other)
sum(is.na(covid_cas$Q6==TRUE)) #There're 156 students that didn't respond to this question. 
covid_cas_class = covid_cas[-c(which(is.na(covid_cas$Q6==TRUE))),] #Delete the rows, 1755 responses left. 
### Now organize the data frame to test the difference in CAS score among different classifications.
data_class = data.frame(
  Classification = as.factor(covid_cas_class$Q6),
  CAS_Score = covid_cas_class$CAS_total
)
library(ggplot2)
ggplot(data_class)+aes(x = Classification,y = CAS_Score)+ geom_boxplot(fill="grey")
par(mfrow = c(3,3))
hist(subset(data_class,Classification==1)$CAS_Score, main = "CAS Score for 1st year undergrads")
hist(subset(data_class,Classification==2)$CAS_Score, main = "CAS Score for 2nd year undergrads")
hist(subset(data_class,Classification==3)$CAS_Score, main = "CAS Score for 3rd year undergrads")
hist(subset(data_class,Classification==4)$CAS_Score, main = "CAS Score for 4th year undergrads")
hist(subset(data_class,Classification==5)$CAS_Score, main = "CAS Score for 5th year or more undergrads")
hist(subset(data_class,Classification==6)$CAS_Score, main = "CAS Score for Master students")
hist(subset(data_class,Classification==7)$CAS_Score, main = "CAS Score for PhD students")
hist(subset(data_class,Classification==8)$CAS_Score, main = "CAS Score for Students \n not seeking for a degree")
hist(subset(data_class,Classification==9)$CAS_Score, main = "CAS Score for Other students")

kruskal.test(CAS_Score~Classification,data = data_class)#Do not reject the null 

### We also wanna investigate if the race/ethnicity makes a difference in the analysis result. 
### Coding: 
### 1. Native Alaskan/ American Indian
### 2. Asian or Asian American
### 3. Black or African American
### 4. Hispanic/Latino/a/x
### 5. MENA/Middle Eastern Origin
### 6. Pacific Islander/Hawaiian
### 7. White/ Caucasian
### 8. Biracial/Multiracial
### 9. Other
### Demographics
sum(is.na(covid_cas$Q4==TRUE)) #There're 153 students that didn't respond to this question. 
covid_cas_race = covid_cas[-c(which(is.na(covid_cas$Q4==TRUE))),] #Delete the rows, 1758 responses left.
data_race = data.frame(
  Ethnicity = as.factor(covid_cas_race$Q4),
  CAS_Score = covid_cas_race$CAS_total
)
table(data_race$Ethnicity)
### This part provides the mean CAS value by groups
aggregate(data_race[, 2], list(data_race$Ethnicity), mean)
### Boxplot comparison
ggplot(data_race)+aes(x = Ethnicity,y = CAS_Score)+ geom_boxplot(fill="grey")
### We see that group 5 and group 6 generally has lower 
par(mfrow = c(3,3))
hist(subset(data_race,Ethnicity==1)$CAS_Score, main = "CAS Score for Native Alaskan/American Indian")
hist(subset(data_race,Ethnicity==2)$CAS_Score, main = "CAS Score for Asian/Asian American")
hist(subset(data_race,Ethnicity==3)$CAS_Score, main = "CAS Score for Black/African American")
hist(subset(data_race,Ethnicity==4)$CAS_Score, main = "CAS Score for Hispanic/Latino/a/x")
hist(subset(data_race,Ethnicity==5)$CAS_Score, main = "CAS Score for MENA/Arab Origin")
hist(subset(data_race,Ethnicity==6)$CAS_Score, main = "CAS Score for Pacific/Islander")
hist(subset(data_race,Ethnicity==7)$CAS_Score, main = "CAS Score for White/Caucasian")
hist(subset(data_race,Ethnicity==8)$CAS_Score, main = "CAS Score for Biracial/Multiracial")
hist(subset(data_race,Ethnicity==9)$CAS_Score, main = "CAS Score for Others")
kruskal.test(CAS_Score~Ethnicity,data = data_race)#Do not reject the null 
### Demographics
sum(subset(data_race,Ethnicity==1)$CAS_Score<9)
sum(subset(data_race,Ethnicity==1)$CAS_Score>=9)
sum(subset(data_race,Ethnicity==2)$CAS_Score<9)
sum(subset(data_race,Ethnicity==2)$CAS_Score>=9)
sum(subset(data_race,Ethnicity==3)$CAS_Score<9)
sum(subset(data_race,Ethnicity==3)$CAS_Score>=9)
sum(subset(data_race,Ethnicity==4)$CAS_Score<9)
sum(subset(data_race,Ethnicity==4)$CAS_Score>=9)
sum(subset(data_race,Ethnicity==5)$CAS_Score<9)
sum(subset(data_race,Ethnicity==5)$CAS_Score>=9)
sum(subset(data_race,Ethnicity==6)$CAS_Score<9)
sum(subset(data_race,Ethnicity==6)$CAS_Score>=9)
sum(subset(data_race,Ethnicity==7)$CAS_Score<9)
sum(subset(data_race,Ethnicity==7)$CAS_Score>=9)
sum(subset(data_race,Ethnicity==8)$CAS_Score<9)
sum(subset(data_race,Ethnicity==8)$CAS_Score>=9)
sum(subset(data_race,Ethnicity==9)$CAS_Score<9)
sum(subset(data_race,Ethnicity==9)$CAS_Score>=9)

### We also wanna investigate if the financial situation makes a difference in the analysis result. 
sum(is.na(covid_cas$Q24==TRUE)) #There're 178 students that didn't respond to this question. 
covid_cas_fin = covid_cas[-c(which(is.na(covid_cas$Q24==TRUE))),] #Delete the rows, 1758 responses left.
data_fin = data.frame(
  fin = as.factor(covid_cas_fin$Q24),
  CAS_Score = covid_cas_fin$CAS_total
)
table(data_fin$fin)
sum(subset(data_fin,fin==1)$CAS_Score<9)
sum(subset(data_fin,fin==1)$CAS_Score>=9)
sum(subset(data_fin,fin==2)$CAS_Score<9)
sum(subset(data_fin,fin==2)$CAS_Score>=9)
sum(subset(data_fin,fin==3)$CAS_Score<9)
sum(subset(data_fin,fin==3)$CAS_Score>=9)
sum(subset(data_fin,fin==4)$CAS_Score<9)
sum(subset(data_fin,fin==4)$CAS_Score>=9)
sum(subset(data_fin,fin==5)$CAS_Score<9)
sum(subset(data_fin,fin==5)$CAS_Score>=9)
kruskal.test(CAS_Score~fin,data = data_fin)


#have you experienced any discriminatory or hostile behavior due to your race/ethnicity 
covid_cas_racism = covid_cas[-c(which(is.na(covid_cas$Q22==TRUE))),] #Delete the rows, 1758 responses left.
data_racism = data.frame(
  racism = as.factor(covid_cas_racism$Q22),
  CAS_Score = covid_cas_racism$CAS_total
)
table(data_racism$racism)
sum(subset(data_racism,racism==1)$CAS_Score<9)
sum(subset(data_racism,racism==1)$CAS_Score>=9)
sum(subset(data_racism,racism==2)$CAS_Score<9)
sum(subset(data_racism,racism==2)$CAS_Score>=9)
wilcox.test(CAS_Score~racism,data = data_racism)
detach(covid_cas)
```
The above analysis provide insufficient evidence to reject the null such that there is a difference between the ethnic groups when dealing with the anxiety from COVID-19. ($\bold{Which, somehow, it's a disappointing result, however, providing a reasonable way to explain such phenomenon within our subjective population.})

### PSS scale data cleaning starts here.(With primary explanatory data analysis) 
The calculation of PSS score follows the guidelines below:
scores for Q4,5,7,8 are reversed (positive questions: 0=4,1=3,2=2,3=1,4=0);
Then sum over all the questions. 
```{r PSS: Perceived Stress Scale}
covid_pss = covid[-c(which(is.na(covid$PSS_1)==TRUE|is.na(covid$PSS_2)==TRUE|is.na(covid$PSS_3)==TRUE|
is.na(covid$PSS_4)==TRUE|is.na(covid$PSS_5)==TRUE|is.na(covid$PSS_6)==TRUE|is.na(covid$PSS_7)==TRUE|is.na(covid$PSS_8)==TRUE|is.na(covid$PSS_9)==TRUE|is.na(covid$PSS_10)==TRUE)),]
dim(covid_pss) #345 responses was deleted here. 1738 responses left for CAS scale calculation
##### We shall only include complete responses for a scale. 
##### Adding a column for total score of PSS, notice in the qualtrics the responses were labelled as 1-5.
##### Instead the actual range for each response is 0-4. 
##### 1,2,3,6,9,10 are negative questions, so sum them first and -6 for the reasons stated above. 
##### For 4,5,7,8, the original range in the dataset is 1-5. Now we reverse it by using 5 minus the item. 
attach(covid_pss)
covid_pss$PSS_total = (PSS_1+PSS_2+PSS_3+ PSS_6+PSS_9+PSS_10 -6)+(5-PSS_4)+(5-PSS_5)+(5-PSS_7)+(5-PSS_8) 
detach(covid_pss)
mean(covid_pss$PSS_total) #The mean value is in fact very high for all valid participants.
hist(covid_pss$PSS_total)
#### Suppose we want to use the reference from New Hampshire Dept. of Administrative Service
### 0-13: low stress
### 14-26: moderate stress
### 27-40: high stress
attach(covid_pss)
library(plotrix)
stress_class = c(sum(PSS_total<=13),sum(PSS_total>13 & PSS_total<27),sum(PSS_total>=27))
#stress_class_percent = c(sum(PSS_total<=13),sum(PSS_total>13 & PSS_total<27),sum(PSS_total>=27))/length(PSS_total)
pie(stress_class,labels = c("Low Perceived Stress \n (16.05%)","Moderate Perceived Stress \n (56.67%)","High Perceived Stress \n (27.27%) "),cex = 1.1,col = c('azure','darkorange','firebrick'),radius = 1)
pie3D(stress_class,main ="The Classification of student participants based on PSS",labels = c("Low Perceived Stress \n (16.05%)","Moderate Perceived Stress \n (56.67%)","High Perceived Stress \n (27.27%) "),explode = 0.05,labelcex = 0.8,col = c('azure','darkorange','firebrick'),theta = pi/5) #I think, sequential color schemes are proper
covid_pss_gender = covid_pss[-c(which(is.na(covid_pss$Q1.1==TRUE))),] #1730 responses are left.
### Now organize the data frame to test the difference in CAS score among different gender group
data_gender_pss = data.frame(
  Sex = as.factor(covid_pss_gender$Q1.1),
  PSS_Score = covid_pss_gender$PSS_total
)
table(data_gender_pss$Sex)
sum(subset(data_gender_pss,Sex==1)$PSS_Score<=13)
sum(subset(data_gender_pss,Sex==1)$PSS_Score<27 & subset(data_gender_pss,Sex==1)$PSS_Score>13)
sum(subset(data_gender_pss,Sex==1)$PSS_Score>=27)
sum(subset(data_gender_pss,Sex==2)$PSS_Score<=13)
sum(subset(data_gender_pss,Sex==2)$PSS_Score<27 & subset(data_gender_pss,Sex==2)$PSS_Score>13)
sum(subset(data_gender_pss,Sex==2)$PSS_Score>=27)
sum(subset(data_gender_pss,Sex==3)$PSS_Score<=13)
sum(subset(data_gender_pss,Sex==3)$PSS_Score<27 & subset(data_gender_pss,Sex==3)$PSS_Score>13)
sum(subset(data_gender_pss,Sex==3)$PSS_Score>=27)
library(ggplot2)
ggplot(data_gender_pss)+aes(x = Sex,y = PSS_Score)+ geom_boxplot(fill="grey")
## We shall see a big difference between the distribution of Male, Female and "other", then check the histogram of each subgroup
par(mfrow = c(3,1))
hist(subset(data_gender_pss,Sex==1)$PSS_Score, main = "PSS Score for Male Students")
hist(subset(data_gender_pss,Sex==2)$PSS_Score, main = "PSS Score for Female Students")
hist(subset(data_gender_pss,Sex==3)$PSS_Score, main = "PSS Score for Other Students") ### None of the above follows a normal distribution, hence we attempt to do Shapiro-Wilks test to check the normality
shapiro.test(subset(data_gender_pss,Sex==1)$PSS_Score)
shapiro.test(subset(data_gender_pss,Sex==2)$PSS_Score)
shapiro.test(subset(data_gender_pss,Sex==3)$PSS_Score)
###We shall reject the normality assumptions for all of these, we should go for Kruskal-Wallis test (Wilcox test is for 2 groups comparison)
kruskal.test(PSS_Score~Sex,data = data_gender_pss)
###### Ethnicity
sum(is.na(covid_pss$Q4==TRUE)) #There're 7 students that didn't respond to this question. 
covid_pss_race = covid_pss[-c(which(is.na(covid_pss$Q4==TRUE))),] #Delete the rows, 1731 responses left.
data_race_pss = data.frame(
  Ethnicity = as.factor(covid_pss_race$Q4),
  PSS_Score = covid_pss_race$PSS_total
)
### This part provides the mean PSS value by groups, no difference.
aggregate(data_race_pss[, 2], list(data_race_pss$Ethnicity), mean)
### Boxplot comparison
ggplot(data_race_pss)+aes(x = Ethnicity,y = PSS_Score)+ geom_boxplot(fill="grey")
### We see that group 5 and group 6 generally has lower 

kruskal.test(PSS_Score~Ethnicity,data = data_race_pss)#Do not reject the null
covid_pss_racism = covid_pss[-c(which(is.na(covid_pss$Q22==TRUE))),] #Delete the rows, 1758 responses left.
data_racism_pss = data.frame(
  racism = as.factor(covid_pss_racism$Q22),
  PSS_Score = covid_pss_racism$PSS_total
)
table(data_racism_pss$racism)
sum(subset(data_racism_pss,racism==1)$PSS_Score<=13)
sum(subset(data_racism_pss,racism==1)$PSS_Score<27 & subset(data_racism_pss,racism==1)$PSS_Score>13)
sum(subset(data_racism_pss,racism==1)$PSS_Score>=27)
sum(subset(data_racism_pss,racism==2)$PSS_Score<=13)
sum(subset(data_racism_pss,racism==2)$PSS_Score<27 & subset(data_racism_pss,racism==2)$PSS_Score>13)
sum(subset(data_racism_pss,racism==2)$PSS_Score>=27)
wilcox.test(PSS_Score~racism,data = data_racism_pss)

```
### MDI scale data cleaning starts here. (With primary explanatory data analysis)
### Completed on Apr. 11th
```{r MDI: Major Depression Inventory}
covid_mdi = covid[-c(which(is.na(covid$MDI_1)==TRUE|is.na(covid$MDI_2)==TRUE|is.na(covid$MDI_3)==TRUE|
is.na(covid$MDI_4)==TRUE|is.na(covid$MDI_5)==TRUE|is.na(covid$MDI_6)==TRUE|is.na(covid$MDI_7)==TRUE|is.na(covid$MDI_8)==TRUE|is.na(covid$MDI_9)==TRUE|is.na(covid$MDI_10)==TRUE|is.na(covid$MDI_11)==TRUE|is.na(covid$MDI_12)==TRUE)),]
dim(covid_mdi)###1850 responses left
attach(covid_mdi)
### The true coding is 5 to 0, while the default coding is 1 to 6. 
covid_mdi$MDI_total = (5*8-(MDI_1+MDI_2+MDI_3+ MDI_4+MDI_5+MDI_6 +MDI_7+MDI_10-8))+(pmax(6-MDI_8,6-MDI_9))+
  (pmax(6-MDI_11,6-MDI_12)) ##Since the actual labeling is 5-0 while our labeling is 1-6. 
#We calculate the score in this way since we didn't intend to use it as a diagnostic tool so instead of diagnosis, this is used as a rating scale like Hamilton scale. The threshold: 21-25: mild; 26-30: moderate; 31 or higher: severe
detach(covid_mdi)
mean(covid_mdi$MDI_total) #The mean value is in fact very high for all valid participants.
hist(covid_mdi$MDI_total)
dep_class = c(sum(MDI_total<=20),sum(MDI_total>20 & MDI_total<=25),sum(MDI_total> 25 & MDI_total<= 30),sum(MDI_total >30))
pie(dep_class,labels = c("No Depression \n (48.000%)","Mild Depression \n (10.162%)","Moderate Depression \n (10.595%) ","Severe Depression \n (31.243%) "),cex = 1.1,col = c('azure','darkorange','firebrick',"blue"),radius = 1)
barplot(dep_class,names.arg = c("No Depression","Mild","Moderate","Severe"),main = "Depression")
covid_mdi_gender = covid_mdi[-c(which(is.na(covid_mdi$Q1.1==TRUE))),]
### Now organize the data frame to test the difference in MDI score among different gender group
data_gender_mdi = data.frame(
  Sex = as.factor(covid_mdi_gender$Q1.1),
  MDI_Score = covid_mdi_gender$MDI_total
)
table(data_gender_mdi$Sex) #Notice this happens for the whole survey, our results are biased due to the fact that more than 60% of the participants are women

kruskal.test(MDI_Score~Sex,data = data_gender_mdi)
mean(subset(data_gender_mdi,Sex==1)$MDI_Score)
mean(subset(data_gender_mdi,Sex==2)$MDI_Score)
mean(subset(data_gender_mdi,Sex==3)$MDI_Score) #Present this part and explain it
sum(subset(data_gender_mdi,Sex==2)$MDI_Score>30)/sum(table(data_gender_mdi$Sex)) #20% of female were facing severe depressionï¼Œthis might be due to that female tend to be more empathetic than man in general during a pandemic. 
sum(subset(data_gender_mdi,Sex==1)$MDI_Score>30)/sum(table(data_gender_mdi$Sex))
sum(subset(data_gender_mdi,Sex==3)$MDI_Score>30)/sum(table(data_gender_mdi$Sex))
covid_mdi_race = covid_mdi[-c(which(is.na(covid_mdi$Q4==TRUE))),] 

data_race_mdi = data.frame(
  Ethnicity = as.factor(covid_mdi_race$Q4),
  MDI_Score = covid_mdi_race$MDI_total
)
kruskal.test(MDI_Score~Ethnicity,data = data_race_mdi)

#This is rather strange since the results since it does not suggest the Asians are facing more severe depression compared to other ethnicities
sum(subset(data_race_mdi,Ethnicity == 1)$MDI_Score>30)/sum(data_race_mdi$Ethnicity==1)
sum(subset(data_race_mdi,Ethnicity == 2)$MDI_Score>30)/sum(data_race_mdi$Ethnicity==2)
sum(subset(data_race_mdi,Ethnicity == 3)$MDI_Score>30)/sum(data_race_mdi$Ethnicity==3)
sum(subset(data_race_mdi,Ethnicity == 4)$MDI_Score>30)/sum(data_race_mdi$Ethnicity==4)
sum(subset(data_race_mdi,Ethnicity == 5)$MDI_Score>30)/sum(data_race_mdi$Ethnicity==5)
sum(subset(data_race_mdi,Ethnicity == 6)$MDI_Score>30)/sum(data_race_mdi$Ethnicity==6)
sum(subset(data_race_mdi,Ethnicity == 7)$MDI_Score>30)/sum(data_race_mdi$Ethnicity==7)
sum(subset(data_race_mdi,Ethnicity == 8)$MDI_Score>30)/sum(data_race_mdi$Ethnicity==8)
sum(subset(data_race_mdi,Ethnicity == 9)$MDI_Score>30)/sum(data_race_mdi$Ethnicity==9)


#Racism Question
covid_mdi_racism = covid_mdi[-c(which(is.na(covid_mdi$Q22==TRUE))),] #Delete the rows, 1758 responses left.
data_racism_mdi = data.frame(
  racism = as.factor(covid_mdi_racism$Q22),
  MDI_Score = covid_mdi_racism$MDI_total
)
wilcox.test(MDI_Score~racism,data = data_racism_mdi)
#However, 
```
### Further explanatory analysis (4/11)
1. Determine several more questions to be investigated. 
1.1 Financial (Q24)
1.2 Employment status (Q11)
1.3 Student Status (Q)
1.4 Child (Q15-16)
1.5 Counseling psychologically (Q23)
1.6 Class Standing (Q6)
1.7 Dignosis with COVID-19 ()
1.8 family members or friends were diagnosed ()
2. Determine more types of descriptive results to be reported. 
2.1 (proportions within the groups)
2.2 univaraite analysis based on groups for each question.
2.3 ...


3. Find out if there's more link between the scales can be identified. (correlation)

```{r}
##age
#18-24
c(153,661,337)/1151
#25-34
c(71,204,96)/371
#35-44
c(28,66,26)/120
#45 and over
c(21,27,9)/57
##gender
#Male
c(117,292,106)/515
#Female
c(154,654,344)/1152
#Other

#Other as 
c(2,12,18)/32
## Martial
#Married
c(54,113,38)/205
#divorced
c(6,13,8)/27
#separated
c(1,5,6)/12
#partnered
c(22,116,71)/206
#single
c(186,699,341)/1226
#other
c(4,9,4)/17

## Ethnicity
#Native Alaskan
c(3,8,5)/16
#Asian
c(52,212,77)/341
#AA
c(21,48,27)/96
#Hispanic
c(50,240,113)/403
#MENA
c(4,13,8)/25
#pac
c(6,19,7)/32
#white 
c(117,342,191)/650
#biracial
c(14,67,34)/115
#other
c(6,9,6)/21
#class
#1st undergraduate
c(45,182,58)/285
#2nd year
c(28,161,81)/270
#3rd year
c(40,165,112)/317
#4th year
c(45,141,87)/273
#5th year
c(23,84,51)/158
#Master
c(40,100,34)/174
#doctor
c(46,106,38)/190
#non-degree

## Employment
#full-time
c(60,183,73)/316
#Part-time
c(89,336,170)/595
#Unemployed
c(87,306,127)/520
#Laid
c(18,85,75)/178
#disability
c(0,6,7)/13
#Other
c(15,38,14)/67

## Financial
#a lot more stressful
c(41,320,265)/626
#somewhat more stressful
c(95,375,131)/601
#no change
c(117,220,55)/392
#somewhat less
c(9,28,12)/49
#lot less
c(11,15,5)/31
```

